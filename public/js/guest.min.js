/* Copyright CBT Limited London - may only used with http://razor-cloud.com services */
$(document).ready(function(){$("#switcher").themeswitcher({height:800,width:400,buttonPreText:"You can select a different theme. This is "});$("#tabs").tabs();var b=getURLParameter("pos"),e=getURLParameter("reservationid");$.getJSON(jsonURL(),{service:"reservation",pos:b,id:e},function(a){function c(a,b){var c=0;for(c;c<a.length;c++)if(a[c].key==b)return a.value;return null}function f(a){a?($("div.error span").html(1==a?"Please enter the highlighted field":"Please enter the "+a+" highlighted fields"),
$("div.error").show()):$("div.error").hide()}$("#cbt_reservationname").append(a.name);$("#cbt_customername").text(a.customername);$("#cbt_guestname_1").text(a.customername);$("#cbt_rate_customer").text(a.customername);$("#cbt_productname").append(a.productname);$("#cbt_rate_product").append(a.productname);$("#cbt_emailaddress").append(a.emailaddress);$("#cbt_emailaddress_input").append(a.emailaddress);$("#cbt_mobilephone").append(a.mobilephone);$("#cbt_fromdate").append(a.fromdate);$("#cbt_todate").append(a.todate);
$("#cbt_notes").append(a.notes);$("#cbt_price").append(formatted(a.price,"c",culture(a.currency)));$("#cbt_quote").append(formatted(a.quote,"c",culture(a.currency)));$("#cbt_balance").append(formatted(a.balance,"c",culture(a.currency)));$("#cbt_outstanding").append(formatted(a.balance,"c",culture(a.currency)));var d=$.datepicker.parseDate("yy-mm-dd",a.fromdate);d.setDate(d.getDate()+1);d=$.datepicker.formatDate("yy-mm-dd",d);$("#cbt_etadate").get(0).options[$("#cbt_etadate").get(0).options.length]=
new Option(a.fromdate,a.fromdate);$("#cbt_etadate").get(0).options[$("#cbt_etadate").get(0).options.length]=new Option(d,d);d=a.arrivaltime.split(":",3);$("#cbt_arrival_hour").val(d[0]);$("#cbt_arrival_minute").val(d[1]);d=a.departuretime.split(":",3);$("#cbt_departure_hour").val(d[0]);$("#cbt_departure_minute").val(d[1]);$("#cbt_keys").val(a.productroom);$("#cbt_termsaccepted").val(a.termsaccepted);$("#cbt_feature").feature({pos:b,model:"product",id:a.productid,date:a.fromdate,currency:a.currency,
rows:4,error:!1,fields:[["type","Type","_"],["name","Feature Name"],["price","Price","c"],["unit","Unit"],["notes","Description"]]});$("#cbt_description").info({pos:b,model:"Product",id:a.productid,language:"en",type:"Public"});$(".ui-icon-triangle-1-w").click(function(){prevImage("image");clearTimeout(timerID)});$(".ui-icon-triangle-1-e").click(function(){change("image");clearTimeout(timerID)});$(".ui-icon-play").click(function(){change("image")});$(".ui-icon-pause").click(function(){clearTimeout(timerID)});
$("#cbt_image").image({pos:b,model:"Product",id:a.productid,wait:1500,sequence:1,error:!1});$("#cbt_finance").finance({pos:b,model:"finance",id:a.financeid,error:!1,fields:[["bankname","Bank"],["branchname","Branch"],["branchnumber","Branch #"],["name","Name"],["accountnumber","Account #"],["ibanswift","IBAN/SWIFT"],["currencyname","Currency"]]});$("#cbt_journal").journal({pos:b,accountid:"61",entityid:a.productid,fromdate:"1970-01-01",todate:"2020-12-31",currency:a.currency,error:!1,fields:[["date",
"Date","d"],["process","Trn"],["name","Folio"],["description","Description",40],["debitamount","Debit","c"],["creditamount","Credit","c"]]});var g=new google.maps.LatLng(a.latitude,a.longitude);$("#cbt_map").gmap({center:g,zoom:12,callback:function(){var a=this;a.addMarker({position:g,bounds:!1}).click(function(){a.openInfoWindow({content:"Test Description"},this)})}});$("#cbt_view").view({latitude:a.latitude,longitude:a.longitude,zoom:12,heading:0,pitch:0,error:!1});$("#cbt_route").route({latitude:a.latitude,
longitude:a.longitude,origin:"Raleigh-Durham International Airport",travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,plain:!0,error:!1});$("#cbt_route").route("origin","Raleigh-Durham International Airport");$("#cbt_route_popup").dialog({autoOpen:!1});$("#cbt_route_click").click(function(){$("#cbt_route_popup").dialog({width:700});$("#cbt_route_popup").dialog("open")});$("#cbt_party").party({pos:b,model:"Party",id:a.organizationid,error:!1,fields:[["name","Company Name"],
["emailaddress","Email Address"],["webaddress","Web URL"],["dayphone","Phone Number"],["faxphone","Fax Number"],["mobilephone","Mobile Phone"],["nightphone","Skype Number"],["postaladdress","Postal Address",40],["postalcode","Postal Code"],["country","Country"],["currency","Currency"],["identitynumber","Company Number"],["taxnumber","Tax Reference"]]});$("#cbt_checkin").info({pos:b,model:"Product",id:a.productid,language:"en",type:"CheckIn"});$("#cbt_weather").weather({wid:2521361,unit:"f",image:!0,
range:!0,wind:!0,link:!0,date:!0,error:!1});$("#cbt_rate").rate({pos:b,reservationid:e,ratings:5,error:!1,fields:[["overall","Overall"],["check_in","Check-in"],["cleanliness","Cleanliness"],["comfort","Comfort"],["location","Location"],["service","Service"],["value","Value"]]});$("#cbt_reason").opinion({pos:b,reservationid:e,type:"cbt_reason",legend:"Reason for Accommodation",error:!1,fields:[["Beach / Sun"],["Business Meeting / Event"],["Concert / Music Festival"],["Gambling / Casinos"],["Golf"],
["Great Food / Wine"],["Museum / Cultural / Historical"],["Outdoor / Adventure"],["Shopping"],["Skiing / Winter Sports"],["Spa"],["Sporting Event"],["Theme / Amusement Park"],["Other"]]});$("#cbt_quality").opinion({pos:b,reservationid:e,type:"cbt_quality",legend:"Accommodation Qualities",error:!1,fields:[["Beautiful"],["Charming"],["Comfortable"],["Cozy"],["Elegant"],["Hidden Gem"],["Hot Spot"],["Incredible Staff"],["No Frills"],["Plush"],["Quiet"],["Romantic"],["Roomy"],["Trendy"]]});$("#cbt_suitability").opinion({pos:b,
reservationid:e,type:"cbt_suitability",legend:"Property is Suitable for",error:!1,fields:[["Families with Teenagers"],["Families with Young Children"],["Friends and Family"],["Friends Getaway"],["Large Groups"],["Luxury Minded Travellers"],["Older Travellers"],["People with Disabilities"],["Rugged Travellers"],["Tourists"],["Young Singles"]]});$("#cbt_terms").info({pos:b,model:"Party",id:a.organizationid,language:"en",type:"Contract"});$.getJSON(jsonURL(),{service:"value",pos:b,model:"Reservation",
id:e},function(a){if(!a.message){$("#cbt_beverage").val(c(a,"beverage"));$("#cbt_etadate").val(c(a,"etadate"));$("#cbt_flight").val(c(a,"flight"));var b=c(a,"guestname_1");b&&$("#cbt_guestname_1").val(b);$("#cbt_agerange_1").val(c(a,"agerange_1"));$("#cbt_guestname_2").val(c(a,"guestname_2"));$("#cbt_agerange_2").val(c(a,"agerange_2"));$("#cbt_guestname_3").val(c(a,"guestname_3"));$("#cbt_agerange_3").val(c(a,"agerange_3"));$("#cbt_guestname_4").val(c(a,"guestname_4"));$("#cbt_agerange_4").val(c(a,
"agerange_4"));$("#cbt_guestname_5").val(c(a,"guestname_5"));$("#cbt_agerange_5").val(c(a,"agerange_5"));$("#cbt_guestname_6").val(c(a,"guestname_6"));$("#cbt_agerange_6").val(c(a,"agerange_6"))}}).error(function(){});$("#cbt_guest_form").validate({debug:!0,invalidHandler:function(a,b){f(b.numberOfInvalids())},ignore:".ignore",rules:{cbt_beverage:{required:!0},cbt_country_phone_code:{required:!0},cbt_emailaddress_input:{required:!0,email:!0},cbt_etadate:{required:!0},cbt_flight:{required:!0,minlength:5},
cbt_keys:{required:!0},cbt_mobilephone:{required:!0,minlength:10},cbt_notes:{required:!0,minlength:10},cbt_termsaccepted:{required:!0}},messages:{cbt_beverage:"Select a beverage",cbt_mobilephone:{required:"To keep in touch",minlength:"Minimum ten characters"},cbt_etadate:{required:"Enter the ETA date"},cbt_flight:{required:"Enter a flight number",minlength:"Minimum five characters"},cbt_keys:{required:"Key sets needed"},cbt_emailaddress_input:{required:"Direct email address",email:"Valid address required"},
cbt_notes:{required:"Enter any special requests",minlength:"Minimum ten characters"},cbt_termsaccepted:{required:"Please agree to the terms"}},submitHandler:function(){$.getJSON(jsonURL(),{service:"reservation",method:"set",pos:b,reservationid:e,arrivaltime:$("#cbt_arrival_hour").val()+":"+$("#cbt_arrival_minute").val()+":00",beverage:$("#cbt_beverage").val(),departuretime:$("#cbt_departure_hour").val()+":"+$("#cbt_departure_minute").val()+":00",emailaddress:$("#cbt_emailaddress_input").val(),mobilephone:$("#cbt_mobilephone").val(),
notes:$("#cbt_notes").val(),termsaccepted:$("#cbt_termsaccepted").val()}).error(function(){});$.getJSON(jsonURL(),{service:"value",method:"set",pos:b,model:"Reservation",id:e,keyvalues:[["beverage",$("#cbt_beverage").val()],["etadate",$("#cbt_etadate").val()],["flight",$("#cbt_flight").val()],["guestname_1",$("#cbt_guestname_1").val()],["agerange_1",$("#cbt_agerange_1").val()],["guestname_2",$("#cbt_guestname_2").val()],["agerange_2",$("#cbt_agerange_2").val()],["guestname_3",$("#cbt_guestname_3").val()],
["agerange_3",$("#cbt_agerange_3").val()],["guestname_4",$("#cbt_guestname_4").val()],["agerange_4",$("#cbt_agerange_4").val()],["guestname_5",$("#cbt_guestname_5").val()],["agerange_5",$("#cbt_agerange_5").val()],["guestname_6",$("#cbt_guestname_6").val()],["agerange_6",$("#cbt_agerange_6").val()]]}).error(function(){})}});$("#cbt_card_form").validate({debug:!0,invalidHandler:function(a,b){f(b.numberOfInvalids())},ignore:".ignore",errorLabelContainer:"#cbt_card_error",rules:{cbt_emailaddress:{required:!0,
email:!0},cbt_cardholder:{required:!0,minlength:5},cbt_cardnumber:{required:!0,creditcard:!0},cbt_cardcode:{required:!0,minlength:3},cbt_cardamount:{required:!0,min:10,max:1E6,number:!0}},messages:{cbt_emailaddress:{required:"Enter an email address",email:"Enter a valid address"},cbt_cardholder:{required:"Enter the card holder",minlength:"Minimum {0} characters"},cbt_cardnumber:{required:"Enter the card number",creditcard:"Enter a valid card number"},cbt_cardcode:{required:"Enter the security code",
minlength:"Minimum {0} characters"},cbt_cardamount:{required:"Enter payment amount",min:"Minimum of {0}",max:"Maximum of {0}",number:"Must be a number"}},submitHandler:function(){$.getJSON(jsonURL(),{service:"card",pos:b,productid:a.financeid,date:$.datepicker.formatDate("yy-mm-01",new Date),emailaddress:$("#cbt_emailaddress").val(),cardholder:$("#cbt_cardholder").val(),cardnumber:$("#cbt_cardnumber").val(),cardmonth:$("#cbt_cardmonth").val(),cardyear:$("#cbt_cardyear").val(),cardcode:$("#cbt_cardcode").val(),
amount:$("#cbt_cardamount").val()},function(a){a.message||$("#cbt_popup").dialog("open")}).error(function(){})}});jQuery.validator.addMethod("atLeastOneChecked",function(){return 0<$(".Opinion input:checked").length});$("#cbt_rate_form").validate({debug:!0,invalidHandler:function(a,b){f(b.numberOfInvalids())},ignore:".ignore",errorLabelContainer:"#cbt_rate_error",rules:{cbt_rate_notes:{required:!0},cbt_rate_overall:{required:!0},cbt_reason:{required:!0,minlength:2},cbt_quality:{required:!0,minlength:2},
cbt_suitability:{required:!0,minlength:2}},messages:{cbt_rate_notes:{required:"Please comment!"},cbt_rate_overall:{required:"Please give an overall rating"},cbt_reason:{required:"Please give reason(s) for your trip",minlength:"Please select at least two options"},cbt_quality:{required:"Please rate the property quality",minlength:"Please select at least two options"},cbt_suitability:{required:"Please assess property suitability",minlength:"Please select at least two options"}},submitHandler:function(){$.getJSON(jsonURL(),
{service:"rate",pos:b,reservationid:e,date:$.datepicker.formatDate("yy-mm-01",new Date),reason:$("#cbt_reason").val()},function(){}).error(function(){})}}).error(function(){})})});
