/* Copyright CBT Limited London - may only used with http://razor-cloud.com services */
(function(a){localize();var b={pos:"",model:"",id:"",numberformat:"c",error:!1};a.fn.card=function(d){function e(b){b?(a("div.error span").html(1==b?"Please enter the highlighted field":"Please enter the "+b+" highlighted fields"),a("div.error").show()):a("div.error").hide()}b=a.extend(b,d);return this.each(function(){b.error&&console.log("start "+b.pos+", "+b.model+", "+b.id);var d=a("#cbt_card_form").validate({debug:!0,invalidHandler:function(a,b){e(b.numberOfInvalids())},ignore:".ignore",rules:{cbt_emailaddress:{required:!0,
email:!0},cbt_cardholder:{required:!0,minlength:5},cbt_cardnumber:{required:!0,creditcard:!0},cbt_cardcode:{required:!0,minlength:3},cbt_notes:{required:!0,minlength:10},cbt_payment:{required:!0,number:!0,min:10,max:1E6}},messages:{cbt_emailaddress:{required:"Enter an email address",email:"Enter a valid address"},cbt_cardholder:{required:"Enter the card holder",minlength:"Minimum {0} characters"},cbt_cardnumber:{required:"Enter the card number",creditcard:"Enter a valid card number"},cbt_cardcode:{required:"Enter the security code",
minlength:"Minimum {0} characters"},cbt_payment:{required:"Enter payment amount",number:"Must be a number",min:"Minimum of {0}",max:"Maximum of {0}"},cbt_notes:{required:"Enter reservation notes",minlength:"Minimum {0} characters"}},submitHandler:function(){b.error&&console.log("card submitted "+jsonURL()+", "+b.pos+", "+a("#cbt_emailaddress").val()+", "+a("#cbt_cardholder").val()+", "+a("#cbt_cardnumber").val()+", "+a("#cbt_payment").val());a.getJSON(jsonURL(),{service:"card",pos:b.pos,model:b.model,
id:b.id,date:a.datepicker.formatDate("yy-mm-01",new Date),emailaddress:a("#cbt_emailaddress").val(),notes:a("#cbt_notes").val(),cardholder:a("#cbt_cardholder").val(),cardnumber:a("#cbt_cardnumber").val(),cardmonth:a("#cbt_cardmonth").val(),cardyear:a("#cbt_cardyear").val(),cardcode:a("#cbt_cardcode").val(),amount:a("#cbt_payment").val()},function(c){if(c.message)a("#cbt_message").dialog("open"),a("#cbt_message").html(c.message);else if(a("#cbt_popup").dialog("open"),a("#cbt_quote").html(formatted(c.quote,
b.numberformat,culture(c.currency))),a("#cbt_deposit").html(c.deposit.toFixed(0)+"%"),c.available){a("#cbt_status").html(b.is_available);var d=c.quote*c.deposit/100;a("#cbt_payment").html(formatted(d,b.numberformat,culture(c.currency)));a("body").data("amount",d)}else a("#cbt_status").html(b.not_available);c.message?console.log(c.message):a("#cbt_popup").dialog("open")}).error(function(){b.error&&console.log("card error")})},success:function(){e(d.numberOfInvalids())}})})}})(jQuery);
