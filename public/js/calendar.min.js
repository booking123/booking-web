/* Copyright CBT Limited London - may only used with http://razor-cloud.com services */
(function(c){function d(){a.error&&console.log("calendar "+a.pos+", "+a.productid+", "+a.date+", "+jsonURL());c.getJSON(jsonURL(),{service:"calendar",pos:a.pos,productid:a.productid,date:a.date},function(b){var d=[],f=[];b.message?a.error&&console.log(b.message):(c.each(b.items,function(a,c){d.push(c.date);f.push(c.state)}),c("#cbt_calendar").datepicker({changeMonth:a.changeMonth,changeYear:a.changeYear,onSelect:function(b){h=g?i=c.datepicker.formatDate("yy-mm-dd",new Date(b)):c.datepicker.formatDate("yy-mm-dd",
new Date(b));g=!g;var d=i,e=h,b=new Date(e);b.setDate(b.getDate()+1);e=c.datepicker.formatDate("yy-mm-dd",b);a.error&&console.log("quote "+a.pos+", "+a.productid+", "+a.dateformat+", "+a.numberformat+", "+a.is_available+", "+a.not_available+", "+a.error+", "+d+", "+e);d&&e&&c.getJSON(jsonURL(),{service:"quote",pos:a.pos,productid:a.productid,fromdate:d,todate:e},function(b){if(b.message)a.error&&console.log(b.message);else{c("#cbt_fromdate").html(formatted(d,a.dateformat,culture(b.currency)));c("#cbt_fromdate_readonly").html(formatted(d,
a.dateformat,culture(b.currency)));c("#cbt_todate").html(formatted(e,a.dateformat,culture(b.currency)));c("#cbt_todate_readonly").html(formatted(e,a.dateformat,culture(b.currency)));c("#cbt_price").html(formatted(b.price,a.numberformat,culture(b.currency)));c("#cbt_quote").html(formatted(b.quote,a.numberformat,culture(b.currency)));c("#cbt_deposit").html(b.deposit.toFixed(0)+"%");b.available?c("#cbt_status").html(a.is_available):c("#cbt_status").html(a.not_available);c("#cbt_quote_popup").dialog("open")}}).error(function(){a.error&&
console.log("quote error")})},beforeShowDay:function(a){a=c.datepicker.formatDate("yy-mm-dd",a);a=c.inArray(a,d);return-1==a?[!0,""]:[!1,f[a]]}}))}).error(function(){a.error&&console.log("calendar error")});timerID=setTimeout(d,a.wait)}var a={pos:"",productid:"",dateformat:"d",numberformat:"c",is_available:"Available",not_available:"Not Available",date:"1970-01-01",changeMonth:!0,changeYear:!0,wait:3E4,error:!0},i,h,g=!0,f={init:function(b){a=c.extend(a,b);localize(function(){c("#cbt_fromdate").datepicker({dateFormat:dateFormat(a.dateformat)});
c("#cbt_todate").datepicker({dateFormat:dateFormat(a.dateformat)})});return this.each(function(){localize(function(){a.error&&5E3>a.wait?console.log("Refresh wait must be at least 5 seconds (5000 milliseconds)"):d()})})},productid:function(b){a.error&&console.log("set productid "+b);a.productid=b;d()}};c.fn.calendar=function(b){if(f[b])return f[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return f.init.apply(this,arguments);a.error&&console.log("Method "+b+" does not exist.")}})(jQuery);
